{% extends "directories/base.html" %}
{% load base_tags %}
{% load base_filters %}
{% load bootstrap_pagination_tags %}
{% load directory_tags %}
{% load search_tags %}
{% load nav_tags %}
{% load custom_dir_tags %}


{% block title %}
    {% if MODULE_DIRECTORIES_LABEL_PLURAL %}
        {% blocktrans %}{{ MODULE_DIRECTORIES_LABEL_PLURAL }} List{% endblocktrans %}
    {% else %}
        {% trans "Directories List" %}
    {% endif %} - {{ block.super }}
{% endblock %}

{% block extra_head %}
    {{ block.super }}
    <link rel="alternate" type="application/rss+xml" title="{% trans 'Latest' %}  {% firstof MODULE_DIRECTORIES_LABEL_PLURAL trans 'Directories' %}" href="{% url 'directory.feed' %}" />
{% endblock %}

{% block content_classes %}{{ block.super }} t-search-view{% endblock %}

{% block hero %}
  <div class="focuspoint"
    data-focus-x="{{ focus.x }}" data-focus-y="{{ focus.y }}"
    data-image-w="{{ size.w }}" data-image-h="{{ size.h }}">
    <img src="{% static hero %}">
  </div>

  <h1 id="hero-title">{{ headline }}</h1>
  <nav id="hero-nav" class="relative w-2/3 md:w-1/3 flex flex-row items-center justify-center">
      {% for cat_slug, cat in all_cats.items %}
        <div class="btn btn-success mt-2 ml-2">
            <a href="http://{{ request.META.HTTP_HOST }}/directory/{{ cat_slug }}">
                {{ cat.headline }}
            </a>
        </div>
      {% endfor %}

  </nav>
{% endblock %}

{% block sidebar %}
    
{% endblock %}

{% block content %}
    <script src="{% static 'js/sorting.js' %}"></script>
    <div data-controller='sorting'
        data-sorting-categories="short-term long-term"
        data-sorting-sorts="name">

        <template data-target="sorting.template">
            <span class="text-xl text-italic md:w-full" data-target="sorting.cta">Welcome to our searchable directory. Click the buttons or start typing below to find what you seek.</span>
        
            <nav class="w-2/3 flex justify-around" data-target="sorting.nav">
                <ul class="flex items-center text-xl text-italic md:w-full" data-target="sorting.cat-list">
                    <li data-target="sorting.cat-btn"></li>
                </ul>
                <div>
                    <span data-target="sorting.filter-label">
                        Filter
                    </span>
                    <ul class="flex items-center text-xl text-italic md:w-full" data-target="sorting.filter-list">
                        <li data-target="sorting.filter-btn"></li>
                    </ul>
                </div>
                <div>
                    <span data-target="sorting.sort-label">
                        Sort
                    </span>
                    <ul class="flex items-center text-xl text-italic md:w-full" data-target="sorting.sort-list">
                        <li data-target="sorting.sort-btn"></li>
                    </ul>
                </div>
            </nav>
        </template>

        {% if cat == "rental" %}
            {% airbnb %}
        {% endif %}
        <!-- Sortable grid. -->
        <section class="grid grid-cols-5 gap-4" data-target="sorting.grid">
            {% for directory in directories %}
                <article class="flex flex-col items-center"
                    data-target="sorting.item">
                    <a href="{{ directory.link }}">
                        <div class="h-thumbnail w-thumbnail flex flex-col justify-center">
                            <img
                            class=""
                            src="{{ directory.image.url }}"
                            alt="{% firstof directory.headline trans 'Untitled' %}">
                        </div>
                    </a>
                
                    <address class="flex flex-col text-center">
                    <a href="{{ directory.link }}">
                        <span class="text-2xl inline-block">{% firstof directory.headline trans "Untitled" %}</span>
                        <span class="serif italic text-lg inline-block">{{ directory.address }}</span>
                    </a>
                    {% if directory.website %}
                        <a href="{{directory.website}}" class="text-green text-lg">
                            Visit them at <span class="mono">{{directory.website_display}}</span>!
                        </a>
                    {% endif %}
                    <div class="flex flex-row flex-wrap justify-center">
                        {% if directory.facebook %}
                        <div class="px-2">
                            <a href="{{directory.facebook}}" class="text-green text-lg">
                                <i class="fab fa-facebook"></i>
                            </a>
                        </div>
                        {% endif %}
                        {% if directory.instagram %}
                        <div class="px-2">
                            <a href="{{directory.instagram}}" class="text-green text-lg">
                                <i class="fab fa-instagram"></i>
                            </a>
                        </div>
                        {% endif %}
                        {% if directory.twitter %}
                        <div class="px-2">
                            <a href="{{directory.twitter}}" class="text-green text-lg">
                                <i class="fab fa-twitter"></i>
                            </a>
                        </div>
                        {% endif %}
                        {% if directory.linkedin %}
                        <div class="px-2">
                            <a href="{{directory.linkedin}}" class="text-green text-lg">
                                <i class="fab fa-linkedin"></i>
                            </a>
                        </div>
                        {% endif %}
                    </div>
                    </address>
                    
                    <!-- category OR "LEVEL" -->
                    {% with directory.category_set as directory_cat %}
                    
                    <ul class="list-unstyled capitalize">
                    {% if directory.tags %}
                    <li class="tags">
                        <strong>{% trans "Tags:" %}</strong>
                        {% for tag in directory.tags|tag_split %}
                        <a href="{% url 'directories' %}?q=tag:{{ tag|lower|urlencode }}">{% blocktrans with tag_instance=tag %}{{ tag_instance }},{% endblocktrans %}</a>
                        {% endfor %}
                    </li>
                    {% endif %}
                    
                    </ul>
                    
                    {% endwith %}
                    
                    
                    <!-- tags OR "SPECIALTY" -->
            
                    
                    
                    <p class="item-content">
                    {% if directory.summary %}
                    {{ directory.summary|striptags|truncatewords:15|safe }}
                    {% else %}
                    {{ directory.body|striptags|truncatewords:15|safe }}
                    {% endif %}
                    </p>
                
                </article>
            {% empty %}
                {% if user.profile.is_superuser %}
                    <p><a href="{% url 'directory.add' %}">
                        {% if MODULE_DIRECTORIES_LABEL %}
                            {% blocktrans %}
                                Add a New {{ MODULE_DIRECTORIES_LABEL }}
                            {% endblocktrans %}
                        {% else %}
                            {% trans "Add a New Directory" %}
                        {% endif %}
                    </a></p>
                {% endif %}
            {% endfor %}
        </section>
    </div>
    
    {% paginate %}
{% endblock %}
